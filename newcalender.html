<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Crop Calendar ‚Äî Weather, Pest & Soil (Auto Location)</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
:root{
  --bg1: linear-gradient(180deg,#163a14,#0b2a09);
  --card: rgba(255,255,255,0.08);
  --muted: rgba(255,255,255,0.75);
  --accent: #ffd54a;
  --good: rgba(34,197,94,0.15);
  --warn: rgba(245,158,11,0.12);
  --bad: rgba(239,68,68,0.12);
}
*{box-sizing:border-box;font-family: 'Segoe UI', Roboto, Arial, sans-serif}
body{
  margin:0;padding:20px;background: url("https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1400&auto=format&fit=crop") center/cover fixed, var(--bg1);
  color:#fff;-webkit-font-smoothing:antialiased;
}
.container{max-width:980px;margin:20px auto;padding:18px}

.header-container {
    width: 100%; padding: 25px; background: linear-gradient(to right, rgba(0,0,0,0.35), rgba(0,0,0,0.15));
    border-radius: 18px; margin-bottom: 20px; backdrop-filter: blur(8px); box-shadow: 0 10px 35px rgba(0, 0, 0, 0.35);
}
.header-left { display:flex; align-items:center; gap:18px; }
.header-container h1 { font-size:2.4rem; margin:0; color:#fff; letter-spacing:0.5px; font-weight:700; }
.subtitle { margin:3px 0 0; font-size:1.15rem; color:#d6e8d6; opacity:0.9; }

.intro-box { margin-top:15px; padding:20px; background: rgba(255,255,255,0.15); border-radius:14px; backdrop-filter: blur(7px); border:1px solid rgba(255,255,255,0.12); box-shadow:0 8px 25px rgba(0,0,0,0.25); }
.intro-box p { margin:0; font-size:1.05rem; line-height:1.5rem; color:#f5f5f5; }

.box{background:var(--card);backdrop-filter:blur(8px);padding:24px;border-radius:18px;margin-top:20px;box-shadow:0 8px 30px rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.1)}
.row{display:flex;gap:18px;flex-wrap:wrap}
.col{flex:1;min-width:220px}
label{display:block;font-weight:600;margin-bottom:8px;color:var(--muted);font-size:0.95rem}
input[type="date"], select, input[type="text"], input[type="number"]{
  width:100%;padding:12px;border-radius:10px;border:none;outline:none;font-size:1rem;background:rgba(255,255,255,0.92);color:#111;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);transition:0.2s;
}
input:focus{background:#fff;box-shadow:0 0 0 3px rgba(255,213,74,0.4)}
.btn{display:inline-block;padding:12px 20px;border-radius:12px;background:#2e7d32;border:none;color:#fff;font-weight:700;cursor:pointer;transition:0.2s;box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.btn:hover{background:#388e3c;transform:translateY(-1px)}
.btn.secondary{background:#1565c0}
.btn.secondary:hover{background:#1976d2}
.output{margin-top:25px}
.result{padding:25px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05));box-shadow:0 12px 40px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.15)}
.timeline-item{padding:14px;border-left:4px solid var(--accent);background:rgba(255,255,255,0.05);margin-bottom:12px;border-radius:0 10px 10px 0}
.tag{padding:5px 10px;border-radius:6px;font-size:0.85rem;font-weight:700;display:inline-block;margin-bottom:5px}
.tag.good{background:#22c55e;color:#fff}
.tag.warn{background:#f59e0b;color:#fff}
.tag.bad{background:#ef4444;color:#fff}
.status { margin-top:12px; font-size:0.95rem; color:#e6f4ea; background: rgba(0,0,0,0.25); padding:10px 15px; border-radius:10px; display:inline-block; border:1px solid rgba(255,255,255,0.1); }
.top-controls { display:flex; gap:12px; justify-content:flex-end; align-items:center; margin-bottom:15px; background:rgba(0,0,0,0.2); padding:10px; border-radius:12px; }
.lang-label, .voice-label { color:#fff; font-weight:700; font-size:0.9rem; }
.lang-select, .voice-select { padding:8px; border-radius:8px; border:none; background:#fff; color:#333; font-weight:600; }
.tts-btn { background:rgba(255,255,255,0.1); color:#fff; border:1px solid rgba(255,255,255,0.2); padding:8px 15px; border-radius:8px; cursor:pointer; transition:0.2s; font-weight:600; }
.tts-btn:hover { background:rgba(255,255,255,0.2); }
</style>
</head>
<body>
<div class="container">
  <div class="top-controls">
    <label id="lblLangSelect" class="lang-label" for="langSelect">Language</label>
    <select id="langSelect" class="lang-select">
      <option value="hi" selected>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
      <option value="en">English</option>
      <option value="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</option>
    </select>
    <label id="lblVoiceSelect" class="voice-label" for="voiceSelect">Voice</label>
    <select id="voiceSelect" class="voice-select" style="max-width:200px"></select>
    <button id="testTtsBtn" class="tts-btn">üîä Test</button>
  </div>

  <div class="header-container">
    <div class="header-left">
      <div>
        <h1 id="title">üåæ Smart Crop Calendar</h1>
        <p id="subtitle" class="subtitle">Weather ‚Ä¢ Soil ‚Ä¢ Pest Prediction</p>
      </div>
    </div>
  </div>

  <div class="intro-box">
    <p id="quickStart">üåü <b>Quick Start:</b> Choose crop, sowing date & soil type.</p>
    <div id="locStatus" class="status">Requesting location‚Ä¶</div>
  </div>

  <div class="box">
    <div class="row">
      <div class="col">
        <label id="lblCrop" for="crop">Select Crop</label>
        <select id="crop"></select>
      </div>
      <div class="col">
        <label id="lblSowDate" for="sowDate">Sowing Date</label>
        <input type="date" id="sowDate">
      </div>
      <div class="col">
        <label id="lblSoilType" for="soilType">Soil Type</label>
        <select id="soilType"></select>
      </div>
    </div>

    <hr style="margin:20px 0;opacity:0.1"/>

    <div class="row">
      <div class="col">
        <label id="lblCity" for="owCity">City</label>
        <input type="text" id="owCity" placeholder="City Name">
      </div>
      <div style="display:flex;align-items:end;gap:10px;padding-bottom:2px">
        <button class="btn" onclick="fetchWeather()"><span id="btnFetchText">Fetch Weather</span></button>
        <button class="btn secondary" onclick="useManualWeather()"><span id="btnManualText">Manual</span></button>
      </div>
    </div>

    <div class="row" style="margin-top:15px">
      <div class="col">
        <label id="lblManualWeather">Temp / Humidity / Rain</label>
        <div style="display:flex;gap:10px">
          <input type="number" id="manualTemp" placeholder="¬∞C">
          <input type="number" id="manualHum" placeholder="%">
          <select id="manualRain"></select>
        </div>
      </div>
      <div class="col">
        <label id="lblWeatherNotes">Weather Notes</label>
        <input type="text" id="weatherNotes">
      </div>
    </div>

    <div style="margin-top:20px;display:flex;justify-content:space-between;align-items:center">
      <button class="btn" style="padding:15px 30px;font-size:1.1rem" onclick="generateCalendar()"><span id="btnGenerateText">Generate Calendar</span></button>
      <div id="footerTip" style="font-size:0.85rem;opacity:0.8">Tip: Allow location for automatic weather.</div>
    </div>
  </div>

  <div id="output" class="output"></div>
</div>

<script>
const i18n = {
  hi: {
    title: "üåæ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ï‡•É‡§∑‡§ø ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞",
    subtitle: "‡§Æ‡•å‡§∏‡§Æ ‚Ä¢ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‚Ä¢ ‡§ï‡•Ä‡§ü ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø‡§µ‡§æ‡§£‡•Ä ‚Äî ‡§ë‡§ü‡•ã ‡§≤‡•ã‡§ï‡•á‡§∂‡§®",
    quickStart: "üåü <b>‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§:</b> ‡§´‡§∏‡§≤, ‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§î‡§∞ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ö‡•Å‡§®‡•á‡§Ç‡•§ ‡§™‡•á‡§ú ‡§ë‡§ü‡•ã-‡§≤‡•ã‡§ï‡•á‡§∂‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§ó‡§æ‡•§",
    selectCrop: "‡§´‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç", sowDate: "‡§¨‡•Å‡§µ‡§æ‡§à ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ", soilType: "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞", city: "‡§∂‡§π‡§∞",
    fetchWeather: "‡§Æ‡•å‡§∏‡§Æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç", useManual: "‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤", manualWeather: "‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤ ‡§Æ‡•å‡§∏‡§Æ", weatherNotes: "‡§®‡•ã‡§ü‡•ç‡§∏",
    generate: "‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç", tip: "‡§∏‡•Å‡§ù‡§æ‡§µ: ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§•‡§æ‡§® ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡•§",
    testSample: "‡§Ø‡§π ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§ß‡•ç‡§µ‡§®‡§ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•à‡•§", readCalendar: "‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞ ‡§∏‡•Å‡§®‡•á‡§Ç", readWeather: "‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§®‡•á‡§Ç",
    language: "‡§≠‡§æ‡§∑‡§æ", voice: "‡§Ü‡§µ‡§æ‡§ú‡§º", test: "üîä ‡§ü‡•á‡§∏‡•ç‡§ü", localService: " (‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø)",
    cropNames: { wheat: "‡§ó‡•á‡§π‡•Ç‡§Ç", rice: "‡§ß‡§æ‡§® (‡§ö‡§æ‡§µ‡§≤)", maize: "‡§Æ‡§ï‡•ç‡§ï‡§æ", sugarcane: "‡§ó‡§®‡•ç‡§®‡§æ", millet: "‡§¨‡§æ‡§ú‡§∞‡§æ" },
    soilOptions: { loam: "‡§¶‡•ã‡§Æ‡§ü (Loam)", sandy: "‡§∞‡•á‡§§‡•Ä‡§≤‡•Ä (Sandy)", clay: "‡§ö‡§ø‡§ï‡§®‡•Ä (Clay)" },
    rainOptions: { no: "‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§®‡§π‡•Ä‡§Ç", light: "‡§π‡§≤‡•ç‡§ï‡•Ä ‡§¨‡§æ‡§∞‡§ø‡§∂", heavy: "‡§≠‡§æ‡§∞‡•Ä ‡§¨‡§æ‡§∞‡§ø‡§∂" },
    tempPlaceholder: "‡§§‡§æ‡§™‡§Æ‡§æ‡§® ¬∞C", humPlaceholder: "‡§®‡§Æ‡•Ä %", notesPlaceholder: "‡§®‡•ã‡§ü‡•ç‡§∏", humSuffix: "% ‡§®‡§Æ‡•Ä",
    cityTranslations: { 'Nagpur': '‡§®‡§æ‡§ó‡§™‡•Å‡§∞', 'Lucknow': '‡§≤‡§ñ‡§®‡§ä' },
    calTitle: "üìå ‡§´‡§∏‡§≤ ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞", liveForecast: "‡§≤‡§æ‡§á‡§µ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®", manualWeatherTag: "‡§Æ‡•à‡§®‡•Å‡§Ö‡§≤ ‡§Æ‡•å‡§∏‡§Æ",
    rainExpected: "‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ", noRain: "‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§®‡§π‡•Ä‡§Ç", landPrep: "‡§ñ‡•á‡§§ ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä", prepNote: " (‡§¨‡•Å‡§µ‡§æ‡§à ‡§∏‡•á 7 ‡§¶‡§ø‡§® ‡§™‡§π‡§≤‡•á)",
    fert1: "‡§™‡§π‡§≤‡•Ä ‡§ñ‡§æ‡§¶", fert2: "‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§ñ‡§æ‡§¶", irrigation: "‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à", pestWindow: "‡§ï‡•Ä‡§ü ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä", harvest: "‡§ï‡§ü‡§æ‡§à ‡§ï‡§æ ‡§∏‡§Æ‡§Ø",
    soilSuggestion: "üå± ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§∏‡•Å‡§ù‡§æ‡§µ", adjustedFertilizer: "‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§â‡§∞‡•ç‡§µ‡§∞‡§ï (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ/‡§è‡§ï‡§°‡§º):",
    pestAssessment: "‚ö†Ô∏è ‡§ï‡•Ä‡§ü ‡§Æ‡•Ç‡§≤‡•ç‡§Ø‡§æ‡§Ç‡§ï‡§® ‚Äî ", risk: " ‡§ú‡•ã‡§ñ‡§ø‡§Æ", weatherNotesTitle: "üõ†Ô∏è ‡§Æ‡•å‡§∏‡§Æ ‡§®‡•ã‡§ü‡•ç‡§∏", highRisk: "‡§â‡§ö‡•ç‡§ö", mediumRisk: "‡§Æ‡§ß‡•ç‡§Ø‡§Æ", lowRisk: "‡§ï‡§Æ"
  },
  ml: {
    title: "üåæ ‡¥∏‡µç‡¥Æ‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥ï‡¥≤‡¥£‡µç‡¥ü‡µº",
    subtitle: "‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‚Ä¢ ‡¥Æ‡¥£‡µç‡¥£‡µç ‚Ä¢ ‡¥ï‡µÄ‡¥ü‡¥®‡¥æ‡¥∂‡¥ø‡¥®‡¥ø ‡¥™‡µç‡¥∞‡¥µ‡¥ö‡¥®‡¥Ç",
    quickStart: "üåü <b>‡¥∂‡µà‡¥≤‡¥ø:</b> ‡¥µ‡¥ø‡¥≥, ‡¥®‡¥ü‡¥™‡µç‡¥™‡µÅ‡¥∏‡¥Æ‡¥Ø‡¥Ç & ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï.",
    selectCrop: "‡¥µ‡¥ø‡¥≥ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï", sowDate: "‡¥µ‡¥ø‡¥§‡µº‡¥§‡µç‡¥§‡µΩ ‡¥§‡¥ø‡¥Ø‡¥§‡¥ø", soilType: "‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡¥∞‡¥Ç", city: "‡¥®‡¥ó‡¥∞‡¥Ç",
    fetchWeather: "‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥é‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï", useManual: "‡¥Æ‡¥æ‡¥®‡µÅ‡¥µ‡µΩ", manualWeather: "‡¥Æ‡¥æ‡¥®‡µÅ‡¥µ‡µΩ ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥•", weatherNotes: "‡¥ï‡µÅ‡¥±‡¥ø‡¥™‡µç‡¥™‡µÅ‡¥ï‡µæ",
    generate: "‡¥ï‡¥≤‡¥£‡µç‡¥ü‡µº ‡¥§‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡¥æ‡¥ï‡µç‡¥ï‡µÇ", tip: "‡¥®‡µÅ‡¥±‡µÅ‡¥ô‡µç‡¥ô‡µç: ‡¥ì‡¥ü‡µç‡¥ü‡µã ‡¥≤‡µä‡¥ï‡µç‡¥ï‡µá‡¥∑‡µª ‡¥Ö‡¥®‡µÅ‡¥µ‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥ï.",
    testSample: "‡¥á‡¥§‡µä‡¥∞‡µÅ ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ü‡µÜ‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥∂‡¥¨‡µç‡¥¶‡¥Æ‡¥æ‡¥£‡µç.", readCalendar: "‡¥ï‡¥≤‡¥£‡µç‡¥ü‡µº ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÇ", readWeather: "‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡µÇ",
    language: "‡¥≠‡¥æ‡¥∑", voice: "‡¥µ‡µã‡¥Ø‡¥ø‡¥∏‡µç", test: "üîä ‡¥ü‡µÜ‡¥∏‡µç‡¥±‡µç‡¥±‡µç", localService: " (‡¥™‡µç‡¥∞‡¥æ‡¥¶‡µá‡¥∂‡¥ø‡¥ï‡¥Ç)",
    cropNames: { wheat: "‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç", rice: "‡¥®‡µÜ‡¥≤‡µç‡¥≤‡µç", maize: "‡¥ö‡µã‡¥≥‡¥Ç", sugarcane: "‡¥ï‡¥∞‡¥ø‡¥Æ‡µç‡¥™‡µç", millet: "‡¥ö‡µã‡¥≥‡¥Ç/‡¥§‡¥ø‡¥®" },
    soilOptions: { loam: "‡¥™‡¥∂‡¥ø‡¥Æ‡¥∞‡¥æ‡¥∂‡¥ø (Loam)", sandy: "‡¥Æ‡¥£‡µΩ (Sandy)", clay: "‡¥ö‡µÜ‡¥≥‡¥ø (Clay)" },
    rainOptions: { no: "‡¥Æ‡¥¥ ‡¥™‡µç‡¥∞‡¥§‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤", light: "‡¥®‡µá‡¥∞‡¥ø‡¥Ø ‡¥Æ‡¥¥", heavy: "‡¥ï‡¥®‡¥§‡µç‡¥§ ‡¥Æ‡¥¥" },
    tempPlaceholder: "‡¥ä‡¥∑‡µç‡¥Æ‡¥æ‡¥µ‡µç ¬∞C", humPlaceholder: "‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç %", notesPlaceholder: "‡¥ï‡µÅ‡¥±‡¥ø‡¥™‡µç‡¥™‡µÅ‡¥ï‡µæ", humSuffix: "% ‡¥à‡µº‡¥™‡µç‡¥™‡¥Ç",
    cityTranslations: { 'Nagpur': '‡¥®‡¥æ‡¥ó‡µç‡¥™‡µÇ‡µº', 'Lucknow': '‡¥≤‡¥ñ‡µç‡¥®‡µó' },
    calTitle: "üìå ‡¥µ‡¥ø‡¥≥‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥ï‡¥≤‡¥£‡µç‡¥ü‡µº", liveForecast: "‡¥§‡¥§‡µç‡¥∏‡¥Æ‡¥Ø ‡¥™‡µç‡¥∞‡¥µ‡¥ö‡¥®‡¥Ç", manualWeatherTag: "‡¥Æ‡¥æ‡¥®‡µÅ‡¥µ‡µΩ",
    rainExpected: "‡¥Æ‡¥¥ ‡¥™‡µç‡¥∞‡¥§‡µÄ‡¥ï‡µç‡¥∑‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ", noRain: "‡¥Æ‡¥¥‡¥Ø‡¥ø‡¥≤‡µç‡¥≤", landPrep: "‡¥≠‡µÇ‡¥Æ‡¥ø ‡¥í‡¥∞‡µÅ‡¥ï‡µç‡¥ï‡µΩ", prepNote: " (7 ‡¥¶‡¥ø‡¥µ‡¥∏‡¥Ç ‡¥Æ‡µÅ‡¥Æ‡µç‡¥™‡µç)",
    fert1: "‡¥í‡¥®‡µç‡¥®‡¥æ‡¥Ç ‡¥µ‡¥≥‡¥Ç", fert2: "‡¥∞‡¥£‡µç‡¥ü‡¥æ‡¥Ç ‡¥µ‡¥≥‡¥Ç", irrigation: "‡¥®‡¥®‡¥ö‡µç‡¥ö‡µÅ ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡µÅ‡¥®‡µç‡¥®‡¥§‡µç", pestWindow: "‡¥ï‡µÄ‡¥ü ‡¥®‡¥ø‡¥∞‡µÄ‡¥ï‡µç‡¥∑‡¥£‡¥Ç", harvest: "‡¥µ‡¥ø‡¥≥‡¥µ‡µÜ‡¥ü‡µÅ‡¥™‡µç‡¥™‡µç",
    soilSuggestion: "üå± ‡¥Æ‡¥£‡µç‡¥£‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥Ç", adjustedFertilizer: "‡¥ï‡µç‡¥∞‡¥Æ‡µÄ‡¥ï‡¥∞‡¥ø‡¥ö‡µç‡¥ö ‡¥µ‡¥≥‡¥Ç (‡¥è‡¥ï‡µç‡¥ï‡¥±‡¥ø‡¥®‡µç):",
    pestAssessment: "‚ö†Ô∏è ‡¥ï‡µÄ‡¥ü-‡¥∞‡µã‡¥ó ‡¥µ‡¥ø‡¥≤‡¥Ø‡¥ø‡¥∞‡µÅ‡¥§‡µç‡¥§‡µΩ ‚Äî ", risk: " ‡¥±‡¥ø‡¥∏‡µç‡¥ï‡µç", weatherNotesTitle: "üõ†Ô∏è ‡¥ï‡¥æ‡¥≤‡¥æ‡¥µ‡¥∏‡µç‡¥• ‡¥ï‡µÅ‡¥±‡¥ø‡¥™‡µç‡¥™‡µÅ‡¥ï‡µæ", highRisk: "‡¥â‡¥Ø‡µº‡¥®‡µç‡¥®", mediumRisk: "‡¥á‡¥ü‡¥§‡µç‡¥§‡¥∞‡¥Ç", lowRisk: "‡¥ï‡µÅ‡¥±‡¥û‡µç‡¥û"
  },
  en: {
    title: "üåæ Smart Crop Calendar",
    subtitle: "Weather ‚Ä¢ Soil ‚Ä¢ Pest Prediction ‚Äî Auto Location",
    quickStart: "üåü <b>Quick Start:</b> Choose crop, sowing date & soil type.",
    selectCrop: "Select Crop", sowDate: "Sowing Date", soilType: "Soil Type", city: "City",
    fetchWeather: "Fetch Weather", useManual: "Manual", manualWeather: "Manual Weather", weatherNotes: "Weather Notes",
    generate: "Generate Calendar", tip: "Tip: Allow location for automatic weather.",
    testSample: "This is a test TTS sample in English.", readCalendar: "Read Calendar", readWeather: "Weather Notes",
    language: "Language", voice: "Voice", test: "üîä Test", localService: " (local)",
    cropNames: { wheat: "Wheat", rice: "Rice", maize: "Maize", sugarcane: "Sugarcane", millet: "Millet" },
    soilOptions: { loam: "Loam (balanced)", sandy: "Sandy (drains fast)", clay: "Clay (holds water)" },
    rainOptions: { no: "No rain expected", light: "Light rain", heavy: "Heavy rain" },
    tempPlaceholder: "Temp ¬∞C", humPlaceholder: "Humidity %", notesPlaceholder: "Notes", humSuffix: "% hum",
    cityTranslations: { 'Nagpur': 'Nagpur', 'Lucknow': 'Lucknow' },
    calTitle: "üìå Crop Calendar", liveForecast: "Live forecast", manualWeatherTag: "Manual",
    rainExpected: "Rain expected", noRain: "No rain", landPrep: "Land Preparation", prepNote: " (7 days before)",
    fert1: "1st Fertilizer", fert2: "2nd Fertilizer", irrigation: "Irrigation Start", pestWindow: "Pest Monitoring", harvest: "Harvest",
    soilSuggestion: "üå± Soil Suggestion", adjustedFertilizer: "Adjusted fertilizer (kg/acre):",
    pestAssessment: "‚ö†Ô∏è Pest Assessment ‚Äî ", risk: " risk", weatherNotesTitle: "üõ†Ô∏è Weather Notes", highRisk: "High", mediumRisk: "Medium", lowRisk: "Low"
  }
};

let currentLang = 'hi'; // DEFAULT CHANGED TO HINDI
const cropDB = [
  { id:"wheat", duration:140, fert1:20, fert2:50, irrigation:15, pestWindow:70, pestSensitivity:"medium", fertilizerDosageKgPerAcre:{urea:40,dap:30} },
  { id:"rice", duration:120, fert1:25, fert2:45, irrigation:10, pestWindow:60, pestSensitivity:"high", fertilizerDosageKgPerAcre:{urea:60,dap:40} },
  { id:"maize", duration:110, fert1:18, fert2:40, irrigation:12, pestWindow:55, pestSensitivity:"medium", fertilizerDosageKgPerAcre:{urea:45,dap:35} },
  { id:"sugarcane", duration:330, fert1:30, fert2:90, irrigation:20, pestWindow:120, pestSensitivity:"low", fertilizerDosageKgPerAcre:{urea:80,dap:50} },
  { id:"millet", duration:95, fert1:15, fert2:35, irrigation:10, pestWindow:50, pestSensitivity:"low", fertilizerDosageKgPerAcre:{urea:30,dap:20} }
];

let voices = [];
const synth = window.speechSynthesis;

function populateVoiceList() {
  voices = synth.getVoices().sort((a,b) => a.name.localeCompare(b.name));
  const voiceSelect = document.getElementById('voiceSelect');
  voiceSelect.innerHTML = '';
  const t = i18n[currentLang];
  voices.forEach((v, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${v.name} ‚Äî ${v.lang}${v.localService ? t.localService : ''}`;
    voiceSelect.appendChild(opt);
  });
  const pref = voices.findIndex(v => v.lang.toLowerCase().startsWith(currentLang));
  if(pref >= 0) voiceSelect.value = pref;
}

function speak(text, langHint) {
  synth.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  const sel = document.getElementById('voiceSelect').value;
  if(voices[sel]) utter.voice = voices[sel];
  utter.lang = (langHint === 'hi' ? 'hi-IN' : langHint === 'ml' ? 'ml-IN' : 'en-US');
  synth.speak(utter);
}

function applyLanguage() {
  const t = i18n[currentLang];
  document.getElementById('title').textContent = t.title;
  document.getElementById('subtitle').textContent = t.subtitle;
  document.getElementById('quickStart').innerHTML = t.quickStart;
  document.getElementById('lblCrop').textContent = t.selectCrop;
  document.getElementById('lblSowDate').textContent = t.sowDate;
  document.getElementById('lblSoilType').textContent = t.soilType;
  document.getElementById('lblCity').textContent = t.city;
  document.getElementById('btnFetchText').textContent = t.fetchWeather;
  document.getElementById('btnManualText').textContent = t.useManual;
  document.getElementById('lblManualWeather').textContent = t.manualWeather;
  document.getElementById('lblWeatherNotes').textContent = t.weatherNotes;
  document.getElementById('btnGenerateText').textContent = t.generate;
  document.getElementById('footerTip').textContent = t.tip;
  document.getElementById('lblLangSelect').textContent = t.language;
  document.getElementById('lblVoiceSelect').textContent = t.voice;
  document.getElementById('testTtsBtn').textContent = t.test;

  const cropSel = document.getElementById('crop');
  const oldCrop = cropSel.value;
  cropSel.innerHTML = cropDB.map(c => `<option value="${c.id}">${t.cropNames[c.id]}</option>`).join('');
  if(oldCrop) cropSel.value = oldCrop;

  const soilSel = document.getElementById('soilType');
  soilSel.innerHTML = Object.entries(t.soilOptions).map(([k,v]) => `<option value="${k}">${v}</option>`).join('');
  
  const rainSel = document.getElementById('manualRain');
  rainSel.innerHTML = Object.entries(t.rainOptions).map(([k,v]) => `<option value="${k}">${v}</option>`).join('');
}

document.getElementById('langSelect').addEventListener('change', (e) => {
  currentLang = e.target.value;
  applyLanguage();
  populateVoiceList();
});

document.getElementById('testTtsBtn').addEventListener('click', () => {
  speak(i18n[currentLang].testSample, currentLang);
});

async function fetchWeather() {
  const city = document.getElementById('owCity').value || "Delhi";
  const apiKey = "3081b138babb030c92442a664ca92ba4";
  try {
    const r = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${apiKey}`);
    const data = await r.json();
    const cur = data.list[0];
    document.getElementById('manualTemp').value = Math.round(cur.main.temp);
    document.getElementById('manualHum').value = cur.main.humidity;
    window.latestWeather = { temp: cur.main.temp, hum: cur.main.humidity, rain: cur.weather[0].main.toLowerCase().includes('rain') };
    document.getElementById('weatherNotes').value = i18n[currentLang].liveForecast;
  } catch(e) { alert("Error fetching weather"); }
}

function generateCalendar() {
  const cropId = document.getElementById('crop').value;
  const sowDate = document.getElementById('sowDate').value;
  if(!sowDate) return alert("Please select date");
  const crop = cropDB.find(c => c.id === cropId);
  const soil = document.getElementById('soilType').value;
  const t = i18n[currentLang];

  const temp = Number(document.getElementById('manualTemp').value) || 25;
  const hum = Number(document.getElementById('manualHum').value) || 60;
  
  let risk = t.lowRisk;
  if(hum > 75 && temp > 20) risk = t.highRisk;
  else if(hum > 60) risk = t.mediumRisk;

  let html = `<div class="result"><h2>${t.calTitle}: ${t.cropNames[cropId]}</h2>`;
  html += `<div class="timeline-item"><b>${t.landPrep}:</b> ${addDays(sowDate, -7)} ${t.prepNote}</div>`;
  html += `<div class="timeline-item"><b>${t.fert1}:</b> ${addDays(sowDate, crop.fert1)}</div>`;
  html += `<div class="timeline-item"><b>${t.irrigation}:</b> ${addDays(sowDate, crop.irrigation)}</div>`;
  html += `<div class="timeline-item"><b>${t.pestWindow}:</b> ${addDays(sowDate, crop.pestWindow)} <span class="tag bad">${t.pestAssessment}${risk}</span></div>`;
  html += `<div class="timeline-item" style="border-left-color:#2e7d32"><b>${t.harvest}:</b> ${addDays(sowDate, crop.duration)}</div>`;
  html += `<button class="tts-btn" onclick="speakCalendar('${t.cropNames[cropId]} calendar generated. Harvest on ${addDays(sowDate, crop.duration)}')">${t.readCalendar}</button></div>`;
  
  document.getElementById('output').innerHTML = html;
}

function addDays(date, days) {
  const d = new Date(date); d.setDate(d.getDate() + days);
  return d.toISOString().split('T')[0];
}

function speakCalendar(txt) { speak(txt, currentLang); }
function useManualWeather() { alert("Enter data manually"); }

// Auto Location
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(async (pos) => {
    const lat = pos.coords.latitude; const lon = pos.coords.longitude;
    const r = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=3081b138babb030c92442a664ca92ba4`);
    const d = await r.json();
    document.getElementById('owCity').value = d.name;
    document.getElementById('locStatus').textContent = "Location: " + d.name;
    fetchWeather();
  }, () => { document.getElementById('locStatus').textContent = "Location denied."; });
}

if (speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = populateVoiceList;
applyLanguage();
populateVoiceList();
</script>
</body>
</html>